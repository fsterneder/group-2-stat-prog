---
title: "Baseball yay"
subtitle: "Programming in Statistics - Project"
author: "Vilsmeier Johannes, Sterneder Florian, Schaub Andrea"
date: '`r Sys.Date()`'
output:
  html_document:
    code_folding: hide
    theme: cosmo
    highlight: tango
    number_sections: true
    toc: true
    toc_float: yes
    fig_width: 7
    fig_height: 4.5
---

```{r hide=T, warning=F, message=F}
library(knitr)
opts_chunk$set(echo = TRUE,
               collapse = TRUE,
               comment = "",
               strip.white = TRUE,
               warning = FALSE,
               messages = FALSE,
               out.width = "70%",
               fig.align = "center")
source("help.R")
```

# Of Age and Baseball

Let's anwers the simplest question first.

## How old is the average active professional baseball player?

We define active as in "played last season" which in our case and dataset is the season of 2018.

```{r}
age_active_players <- 
   left_join(Appearances %>% filter(yearID == 2018), People, "playerID") %>%
   mutate(birthDate = as_date(ymd(paste(birthYear, birthMonth, birthDay, sep = "-")))) %>%
   select(playerID, teamID, birthDate , nameFirst, nameLast, height, weight) 

age_calc <- function(from,to=now()) floor(difftime(now(), from)/dyears(1))
```

Now we can tell that the average active professional baseball player in 2018 was born `r mean(age_active_players$birthDate)` and is therefore `r age_calc(mean(age_active_players$birthDate))` years old. 

Let's visualize that.

```{r}
age_active_players %>% 
   mutate(age = age_calc(birthDate)) %>%
   ggplot(aes(x = age)) +
   geom_line(stat="density") + 
   geom_vline(aes(xintercept = mean(age)), alpha = 0.5, color = "red")
```

Funfact: As we might be able to tell from the graph, the oldest player in the season of 2018 was [`r age_calc(min(age_active_players$birthDate))`](https://en.wikipedia.org/wiki/Bartolo_Col%C3%B3n).

Now we know about the average active player. Let's ...

## Does the age distribution differ significantly per team?

```{r}
names(color$team_main) <- sort(unique(age_active_players$teamID))
names(color$team_second) <- sort(unique(age_active_players$teamID))

age_active_players %>% group_by(teamID) %>% summarise(avgTeamAge = mean(birthDate)) %>% ggplot(aes(reorder(teamID,avgTeamAge),avgTeamAge,color=teamID)) + geom_point(size=2) + scale_color_manual(values=color$team_main) + guides(color=FALSE)

age_active_players %>% ggplot(aes(reorder(teamID,birthDate),birthDate,color=teamID)) + geom_boxplot() + scale_color_manual(values=color$team_main) + guides(color=FALSE)
```

## Does the age distribution differ significantly per season?
